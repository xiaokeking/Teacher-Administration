define(["jquery","tool","template","uploadify","jquery_Jcrop"],function(e,t,i){e(function(){var o,s,a,c,p=t.getParam("cs_id");e.ajax({type:"get",url:"/api/course/picture",data:{cs_id:p},success:function(t){if(200==t.code){var o=i("step2_tpl",t.result);e(".course-add").html(o),e("#upfile").uploadify({swf:"/public/assets/uploadify/uploadify.swf",buttonText:"上传图片",buttonClass:"btn btn-success btn-sm btn_upfile",width:70,height:30,fileObjName:"cs_cover_original",formData:{cs_id:p},itemTemplate:"<span></span>",uploader:"/api/uploader/cover",fileSizeLimit:"2MB",fileTypeExts:"*.gif; *.jpg; *.png",onUploadSuccess:function(t,i){var o=(i=JSON.parse(i)).result.path;e(".preview img").attr("src",o),e(".brief img").attr("src",o),e("#btn_jcrop").removeAttr("disabled")}})}}}),e("body").on("click","#btn_jcrop",function(){"裁切图片"==e(this).text()?(e(this).text("保存图片"),e(".preview img").Jcrop({setSelect:[0,0,1e4,1e4],aspectRatio:2,boxWidth:400},function(){this.initComponent("Thumbnailer",{width:240,height:120,parent:".thumb"});var t=this.getSelection();o=t.x,s=t.y,a=t.w,c=t.h,e(".preview").on("cropmove",function(e,t,i){o=parseInt(i.x),s=parseInt(i.y),a=parseInt(i.w),c=parseInt(i.h)})})):(console.log("呵呵"),e.ajax({type:"post",url:"/api/course/update/picture",data:{cs_id:p,x:o,y:s,w:a,h:c},success:function(e){console.log(e),200==e.code&&(location.href="/course/step3?cs_id="+p)}}))})})});